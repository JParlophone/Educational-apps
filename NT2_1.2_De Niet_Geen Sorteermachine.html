<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>De Niet/Geen Sorteermachine (NT2)</title>
    <style>
        :root {
            --bg: #111827;
            --panel: #1f2937;
            --accent: #f59e0b;
            --good: #10b981;
            --bad: #ef4444;
            --text: #f9fafb;
            --belt: #4b5563;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            color: var(--text);
            background: radial-gradient(circle at 20% 10%, #374151 0%, var(--bg) 55%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }

        .machine {
            width: min(980px, 100%);
            background: linear-gradient(165deg, #334155, #0f172a);
            border: 4px solid #0b1220;
            border-radius: 20px;
            box-shadow: 0 24px 50px rgba(0,0,0,0.5);
            padding: 22px;
        }

        h1 {
            margin: 0;
            font-size: clamp(1.45rem, 2.1vw, 2rem);
            color: #fde68a;
        }

        .subtitle {
            margin: 6px 0 16px;
            color: #e2e8f0;
            font-size: 1rem;
        }

        .hud {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 14px;
        }

        .pill {
            padding: 8px 12px;
            border-radius: 999px;
            background: #1e293b;
            border: 1px solid #64748b;
            font-size: 0.95rem;
        }

        .belt {
            position: relative;
            height: 200px;
            overflow: hidden;
            border-radius: 12px;
            background: repeating-linear-gradient(90deg, var(--belt) 0 30px, #374151 30px 60px);
            border: 3px solid #0f172a;
            outline: 1px solid rgba(255,255,255,0.15);
        }

        .belt::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(0deg, rgba(255,255,255,0.08) 0 2px, transparent 2px 18px);
            pointer-events: none;
        }

        .card {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translate3d(0,-50%,0);
            width: min(84vw, 560px);
            background: #ffffff;
            color: #0f172a;
            border-radius: 14px;
            border: 4px solid #cbd5e1;
            padding: 22px 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.35);
            font-size: clamp(1.2rem, 2.6vw, 1.6rem);
            font-weight: 700;
            line-height: 1.35;
            text-rendering: geometricPrecision;
        }

        .gap {
            display: inline-block;
            min-width: 110px;
            text-align: center;
            margin: 0 4px;
            padding: 0 8px;
            border-bottom: 4px dashed #334155;
            color: var(--accent);
            font-weight: 800;
        }

        .controls {
            margin-top: 14px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            min-width: 140px;
            border: none;
            border-radius: 12px;
            padding: 16px 12px;
            font-size: 1.08rem;
            font-weight: 900;
            letter-spacing: 0.4px;
            cursor: pointer;
            box-shadow: 0 6px 0 rgba(0,0,0,0.3);
            transition: transform 0.08s ease, opacity 0.2s;
        }

        button:active { transform: translateY(2px); }

        .btn-niet { background: var(--bad); color: white; }
        .btn-geen { background: #3b82f6; color: white; }

        .btn-restart {
            background: #facc15;
            color: #111827;
            flex-basis: 100%;
            display: none;
        }

        .feedback {
            min-height: 30px;
            margin-top: 10px;
            font-weight: 800;
            color: #f8fafc;
            font-size: 1rem;
        }

        .feedback.error {
            color: #fecaca;
            text-shadow: 0 0 12px rgba(239,68,68,0.75);
        }

        .alarm {
            position: absolute;
            top: 10px;
            right: 14px;
            font-size: 3.2rem;
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.15s, transform 0.15s;
            z-index: 3;
            filter: drop-shadow(0 0 10px rgba(239,68,68,0.75));
        }

        .alarm.active {
            opacity: 1;
            transform: scale(1.2);
            animation: panicBlink 0.2s linear infinite;
        }

        .boom {
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            pointer-events: none;
            opacity: 0;
            z-index: 2;
        }

        .boom.active {
            animation: explode 0.8s ease-out;
        }

        .boom span {
            font-size: clamp(2.6rem, 12vw, 5.5rem);
            font-weight: 900;
            color: #ffe08a;
            text-shadow: 0 0 16px rgba(255, 95, 31, 0.95), 0 0 36px rgba(239,68,68,0.75);
        }

        @keyframes panicBlink {
            0%, 49% { filter: brightness(1.4) drop-shadow(0 0 14px rgba(239,68,68,0.95)); }
            50%, 100% { filter: brightness(0.55); }
        }

        @keyframes explode {
            0% { opacity: 0; transform: scale(0.4); }
            15% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0; transform: scale(1.8); }
        }

        .stopped {
            outline: 4px solid rgba(239,68,68,0.75);
            box-shadow: 0 0 24px rgba(239,68,68,0.45) inset;
        }
    </style>
</head>
<body>
    <main class="machine">
        <h1>üè≠ De Niet/Geen Sorteermachine</h1>
        <p class="subtitle">Kies snel de juiste knop. Fout = grote alarmmelding. De band start trager en versnelt langzaam.</p>

        <section class="hud">
            <div class="pill">Punten: <strong id="score">0</strong></div>
            <div class="pill">Snelheid: <strong id="speed">0.7x</strong></div>
            <div class="pill">Ronde: <strong id="round">1</strong></div>
            <div class="pill">Zinnen in databank: <strong id="bankCount">0</strong></div>
        </section>

        <section class="belt" id="belt">
            <div class="alarm" id="alarm">üö®</div>
            <div class="boom" id="boom"><span>üí• ALARM üí•</span></div>
            <article class="card" id="card"></article>
        </section>

        <div class="controls">
            <button class="btn-niet" onclick="submitAnswer('niet')">RODE KNOP: NIET</button>
            <button class="btn-geen" onclick="submitAnswer('geen')">BLAUWE KNOP: GEEN</button>
            <button class="btn-restart" id="restart" onclick="restartGame()">Opnieuw starten</button>
        </div>

        <p class="feedback" id="feedback">Druk op de juiste knop voordat de zin verdwijnt.</p>
    </main>

    <script>
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i -= 1) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function buildItems() {
            const items = [];

            const geenPatterns = [
                ['Ik heb ... {n}.', ['auto', 'fiets', 'tijd', 'idee', 'broer', 'zus', 'werk', 'afspraak', 'sleutel', 'vraag']],
                ['Wij drinken ... {n}.', ['koffie', 'thee', 'water', 'melk', 'sap', 'cola', 'alcohol', 'soep']],
                ['Er is ... {n} in de koelkast.', ['melk', 'kaas', 'boter', 'fruit', 'groente', 'yoghurt', 'vlees', 'saus']],
                ['Zij spreekt ... {n}.', ['Engels', 'Nederlands', 'Spaans', 'Arabisch', 'Duits', 'Frans', 'Turks', 'Pools']],
                ['Op tafel ligt ... {n}.', ['boek', 'pen', 'telefoon', 'brief', 'kaart', 'sleutel', 'portemonnee', 'brood']],
                ['In de klas is ... {n}.', ['docent', 'lawaai', 'projector', 'probleem', 'toets', 'huiswerk', 'student', 'stoel']],
                ['Ik eet ... {n}.', ['vlees', 'vis', 'brood', 'suiker', 'rijst', 'pasta', 'fruit', 'dessert']],
                ['Hij heeft ... {n}.', ['kinderen', 'huiswerk', 'ervaring', 'geld', 'zin', 'kans', 'baan', 'internet']]
            ];

            const nietPatterns = [
                ['Ik kom vandaag ... .', ['op tijd', 'naar school', 'mee', 'later', 'buiten', 'thuis', 'alleen', 'met de bus']],
                ['Wij gaan morgen ... .', ['werken', 'op reis', 'naar kantoor', 'naar de les', 'mee', 'uit eten', 'zwemmen', 'fietsen']],
                ['Zij is ... thuis.', ['vandaag', 'meer', 'vaak', 'altijd', 'nog', 'zeker', 'meestal', 'direct']],
                ['Hij wil ... wachten.', ['langer', 'meer', 'buiten', 'hier', 'nu', 'alleen', 'weer', 'daar']],
                ['De printer werkt ... .', ['goed', 'meer', 'vandaag', 'direct', 'zoals vroeger', 'opnieuw', 'goed genoeg', 'snel']],
                ['Ik begrijp de opdracht ... .', ['goed', 'helemaal', 'meer', 'direct', 'meteen', 'altijd', 'volledig', 'precies']],
                ['We kunnen ... beginnen.', ['nu', 'vroeg', 'samen', 'hier', 'straks', 'op tijd', 'meteen', 'vandaag']],
                ['Mijn telefoon doet het ... .', ['meer', 'goed', 'vandaag', 'thuis', 'zonder oplader', 'op tijd', 'zoals gisteren', 'snel']]
            ];

            geenPatterns.forEach(([pattern, words]) => {
                words.forEach((word) => {
                    items.push({ text: pattern.replace('{n}', word), answer: 'geen' });
                });
            });

            nietPatterns.forEach(([pattern, words]) => {
                words.forEach((word) => {
                    items.push({ text: pattern.replace('{n}', word), answer: 'niet' });
                });
            });

            // Variatie met vaste correcte antwoorden, zodat we ruim boven 200 zinnen komen.
            const extrasGeen = ['bananen', 'tomaten', 'stoelen', 'agenda', 'potlood', 'computer', 'wifi', 'parkeerplek', 'vertrouwen', 'bewijs'];
            const extrasNiet = ['vandaag open', 'klaar', 'mogelijk', 'waar', 'duidelijk', 'handig', 'verplicht', 'veilig', 'logisch', 'eerlijk'];

            for (let i = 0; i < 11; i += 1) {
                extrasGeen.forEach((word) => {
                    items.push({ text: `Tijdens ronde ${i + 1} vind ik ... ${word}.`, answer: 'geen' });
                });
                extrasNiet.forEach((word) => {
                    items.push({ text: `Volgens mij is dat ... ${word}.`, answer: 'niet' });
                });
            }

            return shuffle(items);
        }

        const items = buildItems();

        const belt = document.getElementById('belt');
        const card = document.getElementById('card');
        const feedback = document.getElementById('feedback');
        const scoreEl = document.getElementById('score');
        const speedEl = document.getElementById('speed');
        const roundEl = document.getElementById('round');
        const bankCountEl = document.getElementById('bankCount');
        const alarmEl = document.getElementById('alarm');
        const boomEl = document.getElementById('boom');
        const restartBtn = document.getElementById('restart');

        let audioContext;

        function playAlarmSound() {
            try {
                if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const now = audioContext.currentTime;
                const duration = 0.85;
                const gain = audioContext.createGain();
                gain.gain.setValueAtTime(0.0001, now);
                gain.gain.exponentialRampToValueAtTime(0.22, now + 0.03);
                gain.gain.exponentialRampToValueAtTime(0.0001, now + duration);
                gain.connect(audioContext.destination);

                [460, 780, 520].forEach((freq, idx) => {
                    const osc = audioContext.createOscillator();
                    osc.type = idx % 2 === 0 ? 'square' : 'sawtooth';
                    osc.frequency.setValueAtTime(freq, now + idx * 0.2);
                    osc.connect(gain);
                    osc.start(now + idx * 0.05);
                    osc.stop(now + duration);
                });
            } catch (_) {
                // browser blokkeert audio of context niet beschikbaar
            }
        }

        let deck = [];

        let state = {
            score: 0,
            round: 1,
            speed: 0.7,
            x: 0,
            activeItem: null,
            running: true,
            pausedUntil: 0,
            lastTime: 0,
            gameOver: false,
            cardWidth: 560
        };

        function getNextItem() {
            if (deck.length === 0) {
                deck = shuffle([...items]);
            }
            return deck.pop();
        }

        function renderSentence(item) {
            const html = item.text.replace('...', '<span class="gap">___</span>');
            card.innerHTML = html;
            state.cardWidth = card.getBoundingClientRect().width;
        }

        function resetCardPosition() {
            state.x = belt.clientWidth + 24;
            card.style.transform = `translate3d(${Math.round(state.x)}px,-50%,0)`;
        }

        function spawnNext() {
            state.activeItem = getNextItem();
            renderSentence(state.activeItem);
            resetCardPosition();
            roundEl.textContent = state.round;
            speedEl.textContent = `${state.speed.toFixed(1)}x`;
        }

        function setFeedback(message, isError = false) {
            feedback.textContent = message;
            feedback.classList.toggle('error', isError);
        }

        function stopBeltWithAlarm(message) {
            state.pausedUntil = performance.now() + 1400;
            alarmEl.classList.add('active');
            boomEl.classList.remove('active');
            void boomEl.offsetWidth;
            boomEl.classList.add('active');
            belt.classList.add('stopped');
            setFeedback(`FOUT! ${message} üö® Band staat stil...`, true);

            playAlarmSound();
            if (navigator.vibrate) navigator.vibrate([140, 80, 140, 80, 140]);

            setTimeout(() => {
                alarmEl.classList.remove('active');
                boomEl.classList.remove('active');
                belt.classList.remove('stopped');
                if (!state.gameOver) setFeedback('Band gestart. Kies de juiste knop!');
            }, 1400);
        }

        function submitAnswer(choice) {
            if (!state.running || state.gameOver || !state.activeItem) return;

            if (choice === state.activeItem.answer) {
                state.score += 1;
                state.round += 1;
                state.speed = Math.min(2.8, state.speed + 0.07);
                scoreEl.textContent = state.score;
                setFeedback(`Goed! "${choice.toUpperCase()}" is correct. ‚úÖ`);
                spawnNext();
            } else {
                state.speed = Math.max(0.65, state.speed - 0.06);
                speedEl.textContent = `${state.speed.toFixed(1)}x`;
                stopBeltWithAlarm(`Het juiste antwoord was "${state.activeItem.answer.toUpperCase()}".`);
            }
        }

        function gameOver(reason) {
            state.gameOver = true;
            state.running = false;
            setFeedback(reason, true);
            restartBtn.style.display = 'block';
        }

        function restartGame() {
            state = {
                score: 0,
                round: 1,
                speed: 0.7,
                x: 0,
                activeItem: null,
                running: true,
                pausedUntil: 0,
                lastTime: 0,
                gameOver: false,
                cardWidth: 560
            };
            scoreEl.textContent = '0';
            speedEl.textContent = '0.7x';
            roundEl.textContent = '1';
            restartBtn.style.display = 'none';
            setFeedback('Nieuw spel gestart. Veel succes!');
            spawnNext();
            requestAnimationFrame(tick);
        }

        function tick(now) {
            if (!state.running) return;

            if (!state.lastTime) state.lastTime = now;
            const dt = (now - state.lastTime) / 1000;
            state.lastTime = now;

            if (now < state.pausedUntil) {
                requestAnimationFrame(tick);
                return;
            }

            state.x -= dt * 230 * state.speed;
            card.style.transform = `translate3d(${Math.round(state.x)}px,-50%,0)`;

            if (state.x < -state.cardWidth - 40) {
                gameOver('Te laat! De zin is van de band gevallen. Einde spel.');
                return;
            }

            requestAnimationFrame(tick);
        }

        document.addEventListener('keydown', (event) => {
            if (event.key.toLowerCase() === 'n') submitAnswer('niet');
            if (event.key.toLowerCase() === 'g') submitAnswer('geen');
            if (event.key.toLowerCase() === 'r' && state.gameOver) restartGame();
        });

        window.addEventListener('resize', resetCardPosition);

        bankCountEl.textContent = items.length;
        spawnNext();
        requestAnimationFrame(tick);
    </script>
</body>
</html>
